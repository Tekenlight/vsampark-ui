<app-page-header [heading]="'Companies'" [icon]="'fa-table'"></app-page-header>
   <p-table #datatable [value]="companies" [paginator]="true" [rows]="10" sortField="company_name" [globalFilterFields]="['cin','company_name']" 
        [totalRecords]="totalRecords" [lazy]="true" (onLazyLoad)="fetchPageWise($event)"  (onPage)="paginate($event)" [responsive]="true"
    >
            <ng-template pTemplate="caption">
                <div style="text-align: right">
                    <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
                    <input type="text" pInputText size="25" placeholder="Global Search" (input)="datatable.filterGlobal($event.target.value, 'contains')"
                        style="width:auto">
                </div>
            </ng-template>
            <ng-template pTemplate="header" >
                <tr> 
                  <!-- <th>SL No</th> -->
                    <th *ngFor="let col of cols" [pSortableColumn]="col.field" >
                       {{col.header}}
                       <i class="fa fa-sort" style="font-size:15px;color:rgb(31, 23, 68);cursor: pointer"(click)="testing(col.field,$event)" ></i>
                    </th>
                    <th>Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-company let-i="rowIndex">
                    <tr>
                        <!-- <td>{{i+1}}</td> -->
                        <td *ngFor="let col of cols;">
                            <div *ngIf="col.field == 'registered_address' then nested_object_content else normal_content" ></div> <!--nested object-->
                                <ng-template #nested_object_content>
                                    {{company[col.field].line1}}  {{company[col.field].line2}}  {{company[col.field].city}}  {{company[col.field].pincode}}
                                </ng-template>
                                <ng-template #normal_content>
                                    {{company[col.field]}} 
                                </ng-template>
                        </td>
                         <td>   
                               &nbsp; &nbsp;
                              <i class="fa fa-eye" style="font-size:30px;color:#888;cursor: pointer"(click)="viewCompany(company,i)" ></i>  &nbsp;  &nbsp;
                              <i class="fa fa-edit" style="font-size:30px;color:#007ad9;cursor: pointer;"(click)="editCompany(company,i)" ></i>
                               &nbsp;  &nbsp;
                              <i class="fa fa-trash" style="font-size:30px;color:rgb(196, 55, 55);cursor: pointer"(click)="disableCompany(company,i)" ></i>
                              &nbsp;  &nbsp;
                              <i class="fa fa-link" style="font-size:30px;color:rgb(31, 23, 68);cursor: pointer" (click)="show_typeahead_box(company,i)" ></i>
                             
                              <div *ngIf="show_typeahead && i== row_selected"> <!--i==row_selected check : Else typeahead displays for all rows!!-->
                                    <br>
                                    <form [formGroup]="form">
                                        <label >User Name / Email Id</label>
                                        <input id="typeahead-format" type="text" class="form-control" 
                                        formControlName="user_email_id" [ngbTypeahead]="user_search" 
                                        [resultFormatter]="user_formatter" [inputFormatter]="user_formatter" /> 
                                        <br>
                                        <button type="button" [disabled]="form.pristine || form.invalid"  class="btn btn-primary" (click)="save()">Link</button>
                                        <br>
                                        <div *ngIf="duplicate_entry_error" class="alert alert-danger pt-3 mt-3">
                                            <b> {{duplicate_entry_error_message}}</b>
                                        </div>
                                        <div *ngIf="user_not_in_db" class="alert alert-danger pt-3 mt-3">
                                            <b> {{user_name_or_email_id_not_in_db_error_message}}</b>
                                         </div>
                                    </form>
                              </div>
                            </td>
                    </tr>
             </ng-template>
    </p-table>
